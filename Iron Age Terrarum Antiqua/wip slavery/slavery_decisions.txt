# Become a Slave Trader
# Leave Slave Trade
# Buy a Slave
# Sell Bulk Slaves
# Buy Bulk Slaves
# Free Bulk Slaves
# Open Slave Management Menu (UI, Player-Only)
# Close Slave Management Menu (UI, Player-Only)

# Enslave Prisoner
# Sell a Prisoner
# Sell a Slave
# Lash Slave
# Breed Slaves
# Free Slave

# Escape From Slavery Decision

decisions = {
	# close_slave_management_menu = {
		# is_high_prio = yes
		# potential = {
			# ai = no
			# OR = {
				# trait = slave_owner
				# crownlaw_title = {
					# OR = {
						# has_law = slavery_1
						# has_law = slavery_2
					# }
				# }
			# }
			# has_character_flag = flag_slave_management_menu_open
		# }
		# effect = { clr_character_flag = flag_slave_management_menu_open }
	# }
	# Become a Slave Trader
	enter_slave_trade = {
		only_playable = yes
		potential = {
			ai = no #Ai uses yearly event slavery.299
			NOT = { trait = slave_trader } # Obviously, can't do this when already a slave trader		
			crownlaw_title = {
				has_law = slavery_2
				}
			is_nomadic = no			
		}
		allow = { 		
			has_focus = focus_business
			NOT = { trait = liberator } # Won't do this for obvious reasons
		} 
		effect = {
			add_trait = slave_trader
			set_dynasty_flag = flag_slaver_tradition
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 2
				holder_scope = {
					has_government = merchant_republic
					}
				}
		}
	}
	# Leave slave trade
	leave_slave_trade = {
		only_playable = yes
		potential = { 
			is_ruler = yes
			ai = no #Ai uses yearly event slavery.299
			trait = slave_trader 
		}
		allow = { }
		effect = {
			remove_trait = slave_trader
			#clr_dynasty_flag = flag_slaver_tradition
		}
		ai_will_do = {
			factor = 0
			
		}
	}
	# buy_slave = { #Player can use targetted decision to select specific slaves
		# #is_high_prio = yes
		# potential = {
			# is_ruler = yes
			# ai = no #Ai uses yearly event slavery.299
			# can_buy_courtier_slaves_trigger = yes	
			# slave_trader = {
				# NOT = { character = ROOT }
				# OR = {
					# ai = yes
					# NOT = { has_character_flag = slave_trade_cooldown }
					# had_character_flag = { flag = slave_trade_cooldown days = 365 }
				# }
				# slave = {
					# has_opinion_modifier = { who = PREV modifier = opinion_my_owner }
					# NOT = { trait = incapable }
					# NOT = { has_character_flag = flag_not_for_sale }
					# NOT = { has_character_flag = unsullied }
				# }
			# }			
			# # OR = {
				# # ai = yes
				# # has_character_flag = flag_slave_management_menu_open
			# # }
		# }
		# allow = { 
			# wealth = 40 
			# NOT = { is_inaccessible_trigger = yes }
			# NOT = { trait = liberator }
			# is_nomadic = no
			# custom_tooltip = {
				# text = TOOLTIPSLAVEACTION
				# hidden_tooltip = {
					# OR = {
						# NOT = { has_character_flag = flag_slave_action }
						# had_character_flag = { flag = flag_slave_action days = 30 }
					# }
				# }
			# }
		# }
		# effect = {
			# set_character_flag = flag_slave_action
			# character_event = { id = slavery.200 }			
		# }
		# ai_will_do = {
			# factor = 0
		# }
	# }
	buy_bulk_slaves = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			ai = no #Ai uses yearly event slavery.299
			OR = {
				is_patrician = yes
				demesne_size = 1
			}	
			has_full_slavery_trigger = yes	
			NOR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_slavepit_5
						has_building = ct_asoiaf_slavepit_5
						has_building = tp_asoiaf_slavepit_5
						has_building = no_asoiaf_slavepit_5
					}
				}
				family_palace = { has_building = fp_asoiaf_slavepit_5 }
			}
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			custom_tooltip = {
				text = TOOLTIPbuy_bulk_slaves
				hidden_tooltip = {
					slave_trader = {
						is_ruler = yes					
						is_alive = yes
						OR = {
							capital_holding = {
								OR = {
									has_building = ca_asoiaf_slavepit_1
									has_building = ct_asoiaf_slavepit_1
									has_building = tp_asoiaf_slavepit_1
								}
							}
							family_palace = { has_building = fp_asoiaf_slavepit_1 }
						}
						NOT = { character = ROOT }						
					}
				}	
			}
			#OR = {
				wealth = 400
				# hidden_tooltip = { #AI may take loan to buy slaves if they can afford it
					# ai = yes
					# monthly_income = 12
					# wealth = 100
					# NOT = { has_character_flag = loan_taken }
					# NOT = { has_character_modifier = loan_timer }
					# NOT = { has_character_flag = offended_moneylenders }
				# }
			#}	
			NOT = { is_inaccessible_trigger = yes }
			NOT = { trait = liberator }
			is_nomadic = no
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			character_event = { id = slavery.1200 tooltip = "EVTTOOLTIPSLAVERY1200" }
			set_character_flag = flag_slave_action
			clr_character_flag = flag_buying_bulk_slaves
			set_character_flag = flag_buying_bulk_slaves
		}
		ai_will_do = {
			factor = 0
		}
	}
	sell_bulk_slaves = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			is_ruler = yes
			ai = no #Ai uses yearly event slavery.299
			has_full_slavery_trigger = yes		
			OR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_slavepit_1
						has_building = ct_asoiaf_slavepit_1
						has_building = tp_asoiaf_slavepit_1	
						has_building = no_asoiaf_slavepit_1							
					}
				}
				family_palace = { has_building = fp_asoiaf_slavepit_1 }
			}
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			custom_tooltip = {
				text = TOOLTIPsell_bulk_slaves
				hidden_tooltip = {
					slave_trader = {
						is_ruler = yes						
						is_alive = yes
						NOR = {
							capital_holding = {
								OR = {
									has_building = ca_asoiaf_slavepit_5
									has_building = ct_asoiaf_slavepit_5
									has_building = tp_asoiaf_slavepit_5
								}
							}
							family_palace = { has_building = fp_asoiaf_slavepit_5 }
						}
						OR = {
							wealth = 400
							AND = { #AI may take loan to buy slaves if they can afford it
								ai = yes
								NOT = { has_character_flag = loan_taken }
								NOT = { has_character_modifier = loan_timer }
								NOT = { has_character_flag = offended_moneylenders }
								OR = {
									AND = {
										monthly_income = 12
										wealth = 100
									}
									AND = {
										monthly_income = 6
										wealth = 200
									}
									AND = {
										monthly_income = 3
										wealth = 300
									}
								}									
							}
						}
						OR = {
							NOT = { has_character_flag = no_bulk_slave_cooldown }
							had_character_flag = { flag = no_bulk_slave_cooldown days = 730 }
						}
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
						NOT = { character = ROOT }
					}
				}	
			}
			NOT = { is_inaccessible_trigger = yes }
			NOT = { trait = liberator }
			is_nomadic = no
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			character_event = { id = slavery.1300 tooltip = "EVENTTOOLTIPSLAVERY1300" }
			set_character_flag = flag_slave_action
			clr_character_flag = flag_selling_bulk_slaves
			set_character_flag = flag_selling_bulk_slaves
		}
		ai_will_do = {
			factor = 0
		}
	}
	free_bulk_slaves = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			is_ruler = yes
			ai = no #Ai uses yearly event slavery.299
			OR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_slavepit_1
						has_building = ct_asoiaf_slavepit_1
						has_building = tp_asoiaf_slavepit_1
						has_building = no_asoiaf_slavepit_1						
					}
				}
				family_palace = { has_building = fp_asoiaf_slavepit_1 }
			}
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			character_event = { id = slavery.1400 tooltip = "EVTTOOLTIPSLAVERY1400" }
			if = {
				limit = { NOT = { trait = liberator } }
				prestige = -200
			}
			if = {
				limit = {
					has_antislavery_religion_trigger = yes
				}
				piety = 250
			}
			set_character_flag = flag_slave_action
			clr_character_flag = flag_freed_bulk_slaves
			set_character_flag = flag_freed_bulk_slaves
		}
		ai_will_do = {
			factor = 0
		}
	}
	train_unsullied = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			is_ruler = yes
			capital_scope = { culture = astapori }
			NOT = { crownlaw_title = { has_law = slavery_0 } }	
			is_theocracy = no
			OR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_slavepit_1
						has_building = ct_asoiaf_slavepit_1						
					}
				}
				family_palace = { has_building = fp_asoiaf_slavepit_1 }
			}
			NOT = {
				OR = {
					capital_holding = {
						OR = {
							has_building = ca_asoiaf_unsullied_4
							has_building = ct_asoiaf_unsullied_4						
						}
					}
					family_palace = { has_building = fp_asoiaf_unsullied_4 }
				}
			}	
			NOT = { has_character_flag = training_unsullied_4000 }
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			wealth = 125
			NOT = { trait = liberator }
			is_nomadic = no
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			set_character_flag = flag_slave_action
			wealth = -125
			character_event = { id = slavery.1001 tooltip = "EVTTOOLTIPSLAVERY1001" }
			character_event = { id = slavery.700 tooltip = "EVTTOOLTIPSLAVERY700" }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
			}
			modifier = {
				factor = 0
				OR = {
					war = yes
					AND = {
						has_character_flag = loan_taken
						OR = {
							NOT = { wealth = 200 }
							check_variable = { which = "loan_amount" value = 201 }
						}
					}
				}	
			}
			modifier = {
				factor = 0
				trait = kind
				NOT = { trait = ruthless }
				NOT = { trait = arbitrary }
				NOT = { trait = proud }
			}
		}
	}
	buy_unsullied = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			ai = no
			OR = {
				is_patrician = yes
				AND = {
					demesne_size = 1
					higher_tier_than = BARON
				}	
			}
			has_full_slavery_trigger = yes	
			NOT = { capital_scope = { culture = astapori } }
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			wealth = 80
			NOT = { is_inaccessible_trigger = yes }
			NOT = { trait = liberator }
			is_nomadic = no
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			set_character_flag = flag_slave_action
			character_event = { id = slavery.705 tooltip = "EVTTOOLTIPSLAVERY705" }		
		}
		ai_will_do = {
			factor = 0
		}
	}
	mobilise_unsullied = {
		#is_high_prio = yes
		only_playable = yes
		potential = {
			is_ruler = yes
			capital_scope = { culture = astapori }
			NOT = { crownlaw_title = { has_law = slavery_0 } }	
			OR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_unsullied_1
						has_building = ct_asoiaf_unsullied_1	
						has_building = ca_asoiaf_unsullied_cent_1
						has_building = ct_asoiaf_unsullied_cent_1						
					}
				}
				family_palace = { 
					OR = {
						has_building = fp_asoiaf_unsullied_1
						has_building = fp_asoiaf_unsullied_cent_1						
					}
				}
			}	
			# OR = {
				# ai = yes
				# has_character_flag = flag_slave_management_menu_open
			# }
		}
		allow = {
			NOT = { trait = liberator }
			custom_tooltip = {
				text = TOOLTIPSLAVEACTION
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = flag_slave_action }
						had_character_flag = { flag = flag_slave_action days = 30 }
					}
				}
			}
		}
		effect = {
			set_character_flag = flag_selling_unsullied
			if = {
				limit = { #If less than 1000 available moblise them all
					NOT = {
						OR = {
							capital_holding = {
								OR = {
									has_building = ca_asoiaf_unsullied_1
									has_building = ct_asoiaf_unsullied_1						
								}
							}
							family_palace = { 
								has_building = fp_asoiaf_unsullied_1
							}
						}
					}	
				}
				custom_tooltip = { text = TOOLTIPmobilise_unsullied }		
			}
			if = {
				limit = { #If 1000 available mobilise them
					OR = {
						capital_holding = {
							OR = {
								has_building = ca_asoiaf_unsullied_1
								has_building = ct_asoiaf_unsullied_1						
							}
						}
						family_palace = { 
							has_building = fp_asoiaf_unsullied_1
						}
					}	
				}
				tooltip = { 
					character_event = { id = slavery.703 tooltip = "EVTTOOLTIPSLAVERY703" } #Remove 1000 Unsullied
					capital_scope = {
						ROOT = {
							spawn_unit = {
								province = PREV
								home = PREV
								owner = ROOT
								troops = {
									unsullied = { 1000 1000 }
								}
								attrition = 0.5
								reinforces = no
								maintenance = yes
							}
						}
					}
				}
			}
			hidden_tooltip = { character_event = { id = slavery.710 } }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
			}
			modifier = {
				factor = 0
				war = no
			}
			modifier = {
				factor = 0
				NOT = { any_current_enemy = { relative_power = { who = ROOT power = 1 } } }
				capital_holding = { controller = { character = ROOT } } 
			}
			modifier = {
				factor = 2
				is_primary_war_defender = yes 
			}
			modifier = {
				factor = 2
				any_current_enemy = { relative_power = { who = ROOT power = 1.5 } } 
			}
			modifier = {
				factor = 2
				any_current_enemy = { relative_power = { who = ROOT power = 2 } } 
			}
			modifier = {
				factor = 3
				any_current_enemy = { relative_power = { who = ROOT power = 2.5 } } 
			}
			modifier = {
				factor = 4
				any_current_enemy = { relative_power = { who = ROOT power = 3 } } 
			}		
		}
	}
	# open_slave_management_menu = {
		# potential = {
			# ai = no
			# OR = {
				# trait = slave_owner
				# crownlaw_title = {
					# OR = {
						# has_law = slavery_1
						# has_law = slavery_2
					# }
				# }
			# }	
			# NOT = { has_character_flag = flag_slave_management_menu_open }
		# }
		# effect = { set_character_flag = flag_slave_management_menu_open }
	# }
	demand_relatives_freed = {
		is_high_prio = yes
		only_playable = yes
		potential = {
			is_ruler = yes
			any_realm_lord = {
				NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_traitor } }
				OR = {
					NOT = { has_minor_title = title_triarch }
					ROOT = { is_merchant_republic = no }
				}	
				any_courtier = {
					trait = slave
					reverse_has_opinion_modifier = { who = PREV modifier = opinion_my_slave }
					OR = {
						is_married = ROOT
						dynasty = ROOT
						is_close_relative = ROOT
					}
				}
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}				
			}
			NOT = { has_character_flag = demand_relatives_freed }
		}
		effect = {
			random_realm_lord = {
				limit = {
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_traitor } }
					any_courtier = {
						trait = slave
						reverse_has_opinion_modifier = { who = PREV modifier = opinion_my_slave }
						OR = {
							is_married = ROOT
							dynasty = ROOT
							is_close_relative = ROOT
						}
					}
					custom_tooltip = {
						text = TOOLTIPSLAVEACTION
						hidden_tooltip = {
							OR = {
								NOT = { has_character_flag = flag_slave_action }
								had_character_flag = { flag = flag_slave_action days = 30 }
							}
						}
					}
				}	
				set_character_flag = flag_slave_action
				letter_event = { id = slavery.4001 tooltip = "EVTTOOLTIPSLAVERY4001" days = 3 }
				any_courtier = {
					limit = {
						trait = slave
						reverse_has_opinion_modifier = { who = PREV modifier = opinion_my_slave }
						OR = {
							is_married = ROOT
							dynasty = ROOT
							is_close_relative = ROOT
						}
					}
					custom_tooltip = { text = TOOLTIPdemand_relatives_freedSLAVE }
				}
			}		
			set_character_flag = demand_relatives_freed
		}
		ai_will_do = {
			factor = 1000
			modifier = {
				factor = 0
				war = yes
			}
		}
	}
}

targetted_decisions = {	
	# manage_slave = { #moved to yearly pulse event
		# ai_target_filter = home_court
		# filter = home_court
		# #is_high_prio = yes
		# from_potential = {
			# is_ruler = yes
			# ai = yes #ai uses this decision for optimisation reasons
			# trait = slave_owner
			# OR = {
				# NOT = { has_character_flag = flag_slave_action }
				# had_character_flag = { flag = flag_slave_action days = 30 }
			# }	
			# # OR = {
				# # ai = yes
				# # has_character_flag = flag_slave_management_menu_open
			# # }
		# }
		# potential = {
			# trait = slave
			# has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			# NOT = { has_character_flag = unsullied }
			# OR = {
				# FROM = { ai = no }
				# NOT = { has_character_flag = flag_slave_action }
				# had_character_flag = { flag = flag_slave_action days = 365 }
			# }
		# }
		# allow = {
		# }
		# effect = {
			# FROM = { 
				# set_character_flag = flag_slave_action
				# #clr_character_flag = slave_manage_page_2
				# #set_character_flag = slave_manage_page_1
			# }
			# set_character_flag = flag_slave_action			
			# hidden_tooltip = { FROM = { character_event = { id = slavery.2 } } }
		# }
		# ai_will_do = {
			# factor = 1
			
			# modifier = {
				# factor = 0.25
			# }
		# }
	# }
	sell_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner			
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }		
		}
		allow = {
			FROM = { 
				NOT = { trait = liberator }
				#is_nomadic = no 
			}
			custom_tooltip = {
				text = TOOLTIPSELLSLAVEUNSULLIED
				hidden_tooltip = { NOT = { has_character_flag = unsullied } }
			}
			custom_tooltip = { # There must exist at least one possible slave trader to sell to
				text = TOOLTIPSELLSLAVETRADER		
				hidden_tooltip = {
					slave_trader = {
						is_ruler = yes
						is_alive = yes
						wealth = 40					
						NOT = { character = FROM }
					}
				}	
			}	
			prisoner = no
			FROM = {
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}				
			}		
		}
		effect = {
			FROM = {
				set_character_flag = flag_slave_action 
				clr_character_flag = flag_selling_prisoner_into_slavery
			}
			character_event = { id = slavery.152 tooltip = "EVTTOOLTIPSLAVERY152" }
			FROM = {
				if = {
					limit = {
						NOT = { has_full_slavery_trigger = yes }
					}
					custom_tooltip = { text = TOOLTIPSLAVEILEGALSLAVERYWARNING }
				}
			}	
		}
		ai_will_do = {
			factor = 0
		}	
	}
	mark_not_for_sale = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner
			#trait = slave_trader
			NOT = { trait = liberator }
			is_nomadic = no			
			has_full_slavery_trigger = yes
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			NOT = { has_character_flag = flag_not_for_sale }				
		}
		allow = {
			custom_tooltip = {
				text = TOOLTIPSELLSLAVEUNSULLIED
				hidden_tooltip = { NOT = { has_character_flag = unsullied } }
			}
		}
		effect = {
			custom_tooltip = { text = NOTFORSALETOOLTIP }
			set_character_flag = flag_not_for_sale
		}
		ai_will_do = {
			factor = 0
		}	
	}
	mark_for_sale = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner
			#trait = slave_trader	
			NOT = { trait = liberator }
			is_nomadic = no
			NOT = { crownlaw_title = { has_law = slavery_3 } } #not in thralldom
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			has_character_flag = flag_not_for_sale			
		}
		allow = {
		}
		effect = {
			custom_tooltip = { text = FORSALETOOLTIP }
			clr_character_flag = flag_not_for_sale
		}
		ai_will_do = {
			factor = 0
		}	
	}
	breed_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner				
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }		
		}
		allow = {
			FROM = { 
				crownlaw_title = {
						has_law = slavery_2 
					}
				NOT = { trait = liberator }
			}
			# Must be at least theoretically capable of breeding
			NOT = { trait = incapable }
			NOT = { trait = eunuch }
			is_married = no
			age = 16
			is_consort = no
			prisoner = no
			custom_tooltip = { 
				text = TOOLTIPBREEDSLAVEAVAILABLE		
				hidden_tooltip = {
					any_courtier = {
						trait = slave
						has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
						NOT = { character = ROOT }
						is_married = no
						OR = {
							AND = {
								is_female = yes
								NOT = { age = 40 }
								ROOT = { is_female = no }
							}
							AND = {
								is_female = no
								ROOT = { is_female = yes }
							}
						}	
						NOT = { trait = incapable }
						NOT = { trait = eunuch }
						age = 16
						is_consort = no
					}
				}
			}	
			FROM = {
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = flag_slave_action } 
			character_event = { id = slavery.300 tooltip = "EVTTOOLTIPSLAVERY300" }
		}
		ai_will_do = {
			factor = 0
		}	
	}
	stop_breeding_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner	
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			is_married = yes
			spouse = { trait = slave }		
		}
		allow = {
		}
		effect = {
			any_spouse = {
				remove_spouse = PREV
				hidden_tooltip = {
					if = {
						limit = { 
							trait = slave
							NOT = { liege = { character = FROM } } 
						}
						move_character = FROM
					}
				}	
			}
			hidden_tooltip = {
				if = {
					limit = { NOT = { liege = { character = FROM } } }
					move_character = FROM
				}
			}
		}
		ai_will_do = {
			factor = 0
		}	
	}
	lash_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner	
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }	
			liege = { character = FROM }
		}
		allow = {
			FROM = {
				NOT = { trait = kind }
				NOT = { trait = just }
				NOT = { trait = honorable }
				NOT = { trait = liberator }
			}
			NOT = { has_character_modifier = slave_lashed }
		}
		effect = {	
			FROM = {
				if = {
					limit = { NOT = { religion = nath_pagan } }
					piety = -25
				}	
				if = {
					limit = { religion = nath_pagan }
					piety = -50
					custom_tooltip = { text = nath_pagan_ahimsa_tooltip }
				}
				if = {
					limit = {
						NOT = { ROOT = { just_execution_reason_PREV_trigger = yes } }
						NOT = { ROOT = { is_foe = PREV } }
					}
					if = {
						limit = { trait = just }
						if = {
							limit = { NOT = { trait = stressed } }
							add_trait = stressed
						}
						remove_trait = just # Beating your slaves without provocation is always unjust!
					}
				}
				if = {
					limit = { 
						NOT = { trait = cruel } 
						NOT = { trait = kind }
						NOT = { personality_traits = 6 }
					} 
					random = {
						chance = 33
						add_trait = cruel
						hidden_tooltip = { character_event = { id = 38259 } } #Notify Cruel
					}	
				}
				if = {
					limit = { trait = kind }
					if = {
						limit = { NOT = { trait = stressed } }
						add_trait = stressed
					}
					remove_trait = kind				
				}
			}	
			character_event = { id = slavery.500 tooltip = "EVTTOOLTIPSLAVERY500" }			
		}
		ai_will_do = {
			factor = 0
		}	
	}
	concubine_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			has_dlc = "The Old Gods"
			trait = slave_owner
			is_female = no
			has_concubinage = yes			
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			is_female = yes
			is_consort = no					
		}
		allow = {
			FROM = {
				NOT = { trait = liberator }
				below_consort_limit_trigger = yes
			}
			age = 14	
			NOT = { is_close_relative = FROM }			
			hidden_tooltip = {
				OR = {
					FROM = { ai = no }
					NOT = { has_opinion_modifier = { who = FROM modifier = opinion_set_aside } }
				}
			}	
		}
		effect = {
			add_consort = FROM
		}
		ai_will_do = {
			factor = 0
		}	
	}
	eunuch_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner			
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }
			is_female = no
			NOT = { trait = eunuch }			
		}
		allow = {
			FROM = {
				NOT = { trait = liberator }
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
				NOT = { crownlaw_title = { has_law = slavery_3 } } #not in thralldom
			}
		}
		effect = {
			character_event = { id = LoR.833 tooltip = "EVTTOOLTIPLoR.833" }
			add_trait = eunuch
			if = {
				limit = { age = 6 }
				opinion = {
					modifier = opinion_castrated_me
					who = FROM
				}
			}	
			hidden_tooltip = {
				if = {
					limit = { age = 16}
					FROM = {
						character_event = { id = LoR.832 }
					}
				}
				if = {
					limit = { NOT = { age = 16 } }
					FROM = {
						character_event = { id = LoR.834 }
					}
				}
			}	
			FROM = {
				if = {
					limit = { 
						NOT = { trait = cruel } 
						NOT = { trait = kind }
						NOT = { personality_traits = 6 }
					}
					random = {
						chance = 25
						add_trait = cruel
						hidden_tooltip = {
							character_event = { id = 38259 }
						}
					}
				}
				if = {
					limit = { trait = kind }
					random = {
						chance = 25
						remove_trait = kind
						hidden_tooltip = {
							character_event = { id = 38307 }
						}
					}
				}
			}	
			hidden_tooltip = {
				father = { opinion = { who = FROM modifier = opinion_castrated_son } }
				mother = { opinion = { who = FROM modifier = opinion_castrated_son } }
				any_dynasty_member = {
					limit = {
						is_close_relative = ROOT
						NOT = { any_child = { character = ROOT } } 
					}
					opinion = { who = FROM modifier = opinion_castrated_kin }
				}
				any_spouse = {
					limit = { opinion = { who = ROOT value = -25 } }
					opinion = { who = FROM modifier = opinion_castrated_spouse }
				}
			}
		}
		ai_will_do = {
			factor = 0
		}	
	}
	free_slave = {
		ai_target_filter = self
		filter = home_court
		only_playable = yes
		from_potential = {		
			ai = no #ai uses management menu
			is_ruler = yes		
			trait = slave_owner			
		}
		potential = {
			trait = slave
			has_opinion_modifier = { who = FROM modifier = opinion_my_owner }		
		}
		allow = {
			FROM = {
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}
		}
		effect = {			
			clr_character_flag = escaped_slave
			character_event = { id = slavery.0 tooltip = EVTTOOLTIPSLAVERY0 }	
			if = {
				limit = { NOT = { has_opinion_modifier = { who = FROM modifier = opinion_enslaved_me } } }
				opinion = {
					modifier = opinion_granted_freedom
					who = FROM
					years = 5
				}
			}	
			if = {
				limit = { has_opinion_modifier = { who = FROM modifier = opinion_enslaved_me } }
				opinion = {
					modifier = opinion_granted_freedom
					who = FROM
					years = 5
					multiplier = 0.5
				}
			}
			FROM = {
				if = {
					limit = {
						NOR = {
							trait = liberator
							is_close_relative = ROOT
							AND = {
								NOT = { dynasty = 0 }
								dynasty = ROOT
							}
						}	
					}
					prestige = -50
				}	
			}	
		}
		ai_will_do = {
			factor = 0
		}	
	}
	enslave_prisoner = {
		ai_target_filter = court
		filter = court
		only_playable = yes
		from_potential = {
			is_ruler = yes
			NOT = { crownlaw_title = { has_law = slavery_0 } }
		}
		potential = {
			prisoner = yes
			host = { character = FROM }			
			NOT = { trait = dragon }
			NOT = { culture_group = winter_group }	
			OR = {
				NOT = { trait = slave }
				NOT = { has_opinion_modifier = { who = FROM modifier = opinion_my_owner } }
			}				
		}
		allow = {
			FROM = {
				NOT = { trait = liberator }
			}
			is_ruler = no # Cannot enslave rulers
			OR = {	
				NOT = { FROM = { crownlaw_title = { has_law = slavery_3 } } } # Thralldom only allows enslaving prisoners of war
				FROM = { trait = arbitrary }
				custom_tooltip = {
					text = TOOLTIPPOW
					has_character_flag = flag_captured_in_battle
				}	
			}
			NOR = {
				is_married = FROM
				AND = {
					dynasty = FROM
					NOT = { dynasty = 0 }
				}	
				is_close_relative = FROM
			}
		}
		effect = {
			FROM = { save_event_target_as = enslaver }				
			opinion = { who = FROM modifier = opinion_enslaved_me }	
			if = { #If is my subject this is tyrannical 
				limit = {
					OR = {
						is_liege_or_above = FROM
						liege_before_war = { character = FROM }
						any_liege = { liege_before_war = { character = FROM } }
						AND = { #Junior triarchs
							FROM = { has_minor_title = title_triarch }
							any_liege = { 
								is_merchant_republic = yes 
								is_vassal_or_below = FROM
							}
						}
					}	
					NAND = { #does not apply to escaped slaves
						has_character_flag = escaped_slave
						trait = former_slave
					}
				}	
			}
			add_fear_torture_effect = yes	
			enslave_effect = yes			
			hidden_tooltip = {
				FROM = {
					if = { #chronicle important persons
						limit = { ai = no }
						hidden_tooltip = { character_event = { id = CM.11505 } }
					}
					character_event = { id = 45361 days = 1 } #check for tyranny for going against council
					save_event_target_as = remove_prison_reason_effect_accuser
					ROOT = { save_event_target_as = remove_prison_reason_effect_accused }
					hidden_tooltip = { remove_prison_reason_effect = yes }				
				}		
				father = { opinion = { who = FROM modifier = opinion_enslaved_close_relative } }
				mother = { opinion = { who = FROM modifier = opinion_enslaved_close_relative } }
				any_dynasty_member = {
					limit = {
						is_close_relative = PREV
						NOT = { character = PREV }
						NOT = { any_child = { character = PREVPREV } } 
					}
					opinion = { who = FROM modifier = opinion_enslaved_close_relative }
				}				
				event_target:chronicle_player = { #chronicle enslaved relatives
					if = {
						limit = { 
							NOT = { character = FROM }
							OR = {							
								dynasty = ROOT
								is_close_relative = ROOT
								liege = { is_close_relative = ROOT }
								top_liege = { is_close_relative = ROOT }
							}	
						}
						hidden_tooltip = { character_event = { id = CM.11504 } }
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.05
			}			
			modifier = {
				factor = 0
				OR = {
					is_liege_or_above = FROM
					liege_before_war = { character = FROM }
					any_liege = { liege_before_war = { character = FROM } }
				}
				NAND = { #does not apply to escaped slaves
					has_character_flag = escaped_slave
					trait = former_slave
				}
				FROM = {
					NOT = { trait = arbitrary }
					NOT = { trait = ruthless }
					NOT = { trait = cruel }
				}
			}
			
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 0 }
				FROM = {
					NOT = { trait = arbitrary }
					NOT = { trait = ruthless }
					NOT = { trait = cruel }
				}
			}
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 50 }
				FROM = {
					NOT = {
						AND = {
							OR = {
								trait = ambitious
								trait = greedy
								trait = slave_trader
							}
							OR = {
								trait = arbitrary
								trait = ruthless
								trait = cruel
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_close_relative = FROM
					spouse = { character = FROM }
					dynasty = FROM
					FROM = { spouse = { is_close_relative = PREVPREV } }
					FROM = { spouse = { dynasty = PREV } }
				}
				FROM = {
					OR = {
						trait = just
						NOT = { trait = ruthless }
					}
				}
			}
			modifier = { #trying to inspire fear
				factor = 2
				FROM = {
					OR = {
						trait = ruthless
						trait = cruel
					}
					OR = {
						is_close_relative = ROOT
						is_vassal_or_below = ROOT
						ROOT = { liege = { liege_before_war = { character = ROOT_FROM } } }
					}
				}
			}
			modifier = {
				factor = 0
				is_lover = FROM
			}
			modifier = {
				factor = 0
				FROM = { any_current_enemy = { character = ROOT } }
			}
			modifier = {
				factor = 0
				FROM = {
					any_current_enemy = { primary_title = { current_heir = { character = ROOT } } }
					NOT = { trait = wroth }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trait = kind
					NOT = { trait = cynical }
					NOT = { trait = arbitrary }
					NOT = { trait = slave_trader }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					OR = {
						trait = kind
						trait = honorable
					}
					NOT = { trait = slave_trader }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0.05
				FROM = {
					trait = content
					NOT = { trait = slave_trader }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 1 }
				FROM = {
					NOT = { trait = greedy }
					NOT = { trait = selfish }
					NOT = { trait = ruthless }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0
				NOT = { liege = { character = FROM } }
				FROM = {
					OR = {
						NOT = {
							OR = {
								trait = ruthless
								trait = arbitrary
							}
						}
						trait = honorable
						trait = just
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = { trait = slave_trader }
					NOT = { trait = greedy }
					NOT = { trait = cruel }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 4
				FROM = { is_nomadic = yes }
				NOT = { same_realm = FROM }
			}
			modifier = {
				factor = 2
				FROM = { trait = ruthless }
			}
			modifier = {
				factor = 1.5
				FROM = { trait = wroth }
			}		
			modifier = {
				factor = 2
				FROM = { trait = greedy }
			}
			modifier = {
				factor = 1.5
				FROM = { trait = cruel }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = honorable }
			}
			modifier = {
				factor = 0.33
				FROM = { trait = patient }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = kind }
			}
		}
	}
	
	# Sell a prisoner into slavery
	sell_prisoner = {
		ai_target_filter = court
		filter = court
		only_playable = yes
		from_potential = {
			is_ruler = yes
			OR = {
				has_full_slavery_trigger = yes					
				AND = {
					NOT = { trait = just }
					OR = {
						trait = greedy
						trait = cruel
						NOT = { wealth = -40 }
					}					
				}
			}
		}
		potential = {
			prisoner = yes
			host = { character = FROM }		
			NOT = { trait = dragon }
			NOT = { trait = white_walker }
			NOT = { trait = slave }			
		}
		allow = {			
			FROM = {
				NOT = { trait = liberator }				
			}
			prisoner = yes
			NOT = { is_inaccessible_trigger = yes }
			NOR = {
				is_married = FROM
				AND = {
					dynasty = FROM
					NOT = { dynasty = 0 }
				}	
				is_close_relative = FROM
			}	
			is_ruler = no # Cannot enslave rulers
			custom_tooltip = { # There must exist at least one possible slave trader to sell to
				text = TOOLTIPSELLSLAVETRADER		
				hidden_tooltip = {
					slave_trader = {
						is_ruler = yes
						is_alive = yes
						wealth = 40					
						NOT = { character = FROM }
					}
				}	
			}
			FROM = {
				custom_tooltip = {
					text = TOOLTIPSELLINGPRISONER
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_selling_prisoner_into_slavery }
							had_character_flag = { flag = flag_selling_prisoner_into_slavery days = 30 }
						}
					}
				}
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { 
				set_character_flag = flag_selling_prisoner_into_slavery 
				set_character_flag = flag_slave_action
				hidden_tooltip = { character_event = { id = 45361 days = 1 } }#check for tyranny for going against council
			}
			character_event = { id = slavery.150 tooltip = "EVTTOOLTIPSLAVERY150" }			
			if = { #If is my subject this is tyrannical 
				limit = {
					FROM = { 
						ai = no #ai doesn't need tooltip
						has_full_slavery_trigger = yes
					}
					OR = {
						is_liege_or_above = FROM
						liege_before_war = { character = FROM }
						any_liege = { liege_before_war = { character = FROM } }
						AND = { #Junior triarchs
							FROM = { has_minor_title = title_triarch }
							any_liege = { 
								is_merchant_republic = yes 
								is_vassal_or_below = FROM
							}
						}
					}	
					NAND = { #does not apply to escaped slaves
						has_character_flag = escaped_slave
						trait = former_slave
					}					
				}
				tooltip = { add_fear_torture_effect = yes }
				FROM = { 
					custom_tooltip = { text = TOOLTIPINCREASETYRANY1 }	
				}
			}
			if = { #Warn if this is illegal
				limit = {
					FROM = { 
						NOT = {
							has_full_slavery_trigger = yes					
						}
					}					
				}	
				FROM = { 
					custom_tooltip = { text = TOOLTIPSLAVEILEGALSLAVERYWARNING }	
				}	

			}
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.05
			}						
			modifier = {
				factor = 0
				OR = {
					is_liege_or_above = FROM
					liege_before_war = { character = FROM }
					any_liege = { liege_before_war = { character = FROM } }
				}
				NAND = { #does not apply to escaped slaves
					has_character_flag = escaped_slave
					trait = former_slave
				}
				FROM = {
					NOT = { trait = arbitrary }
					NOT = { trait = ruthless }
					NOT = { trait = cruel }
				}
			}
			
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 0 }
				FROM = {
					NOT = { trait = arbitrary }
					NOT = { trait = ruthless }
					NOT = { trait = cruel }
				}
			}
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 50 }
				FROM = {
					NOT = {
						AND = {
							OR = {
								trait = ambitious
								trait = greedy
								trait = slave_trader
							}
							OR = {
								trait = arbitrary
								trait = ruthless
								trait = cruel
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_close_relative = FROM
					spouse = { character = FROM }
					dynasty = FROM
					FROM = { spouse = { is_close_relative = PREVPREV } }
					FROM = { spouse = { dynasty = PREV } }
				}
				FROM = {
					OR = {
						trait = just
						NOT = { trait = ruthless }
					}
				}
			}
			modifier = { #trying to inspire fear
				factor = 2
				FROM = {
					OR = {
						trait = ruthless
						trait = cruel
					}
					OR = {
						is_close_relative = ROOT
						is_vassal_or_below = ROOT
						ROOT = { liege = { liege_before_war = { character = ROOT_FROM } } }
					}
				}
			}
			modifier = {
				factor = 0
				is_lover = FROM
			}
			modifier = {
				factor = 0
				FROM = { any_current_enemy = { character = ROOT } }
			}
			modifier = {
				factor = 0
				FROM = {
					any_current_enemy = { primary_title = { current_heir = { character = ROOT } } }
					NOT = { trait = wroth }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = { trait = cynical }
					NOT = { trait = arbitrary }
					NOT = { trait = slave_trader }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					OR = {
						trait = kind
						trait = honorable
					}
					NOT = { trait = slave_trader }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0.05
				FROM = {
					trait = content
					NOT = { trait = slave_trader }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0
				reverse_opinion = { who = FROM value = 1 }
				FROM = {
					NOT = { trait = greedy }
					NOT = { trait = selfish }
					NOT = { trait = ruthless }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 0
				NOT = { liege = { character = FROM } }
				FROM = {
					OR = {
						NOT = {
							OR = {
								trait = ruthless
								trait = arbitrary
							}
						}
						trait = honorable
						trait = just
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = { trait = slave_trader }
					NOT = { trait = greedy }
					NOT = { trait = cruel }
					is_nomadic = no
				}
			}
			modifier = {
				factor = 4
				FROM = { is_nomadic = yes }
				NOT = { same_realm = FROM }
			}
			modifier = {
				factor = 2
				FROM = { trait = ruthless }
			}
			modifier = {
				factor = 1.5
				FROM = { trait = wroth }
			}		
			modifier = {
				factor = 2
				FROM = { trait = greedy }
			}
			modifier = {
				factor = 1.5
				FROM = { trait = cruel }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = honorable }
			}
			modifier = {
				factor = 0.33
				FROM = { trait = patient }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = kind }
			}
		}
	}
	
	buy_slave_offer = {
		ai_target_filter = self
		filter = all
		only_playable = yes
		from_potential = {
			ai = no
			can_buy_courtier_slaves_trigger = yes
		}
		potential = {
			trait = slave		
			NOT = { has_opinion_modifier = { who = FROM modifier = opinion_my_owner } }
			liege = {
				NOT = { character = FROM }
				has_opinion_modifier = { who = ROOT modifier = opinion_my_slave }
			}
		}
		allow = {
			FROM = {
				NOT = { trait = liberator }
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}
			liege = { NOT = { crownlaw_title = { has_law = slavery_3 } } } #not in thralldom
			custom_tooltip = {
				text = TOOLTIPbuy_slave_offerFORSALE
				hidden_tooltip = { NOT = { has_character_flag = flag_not_for_sale } }
			}	
			custom_tooltip = {
				text = TOOLTIPSELLSLAVEUNSULLIED
				hidden_tooltip = { NOT = { has_character_flag = unsullied } }
			}
			custom_tooltip = {
				text = TOOLTIPbuy_slave_offerRANGE
				hidden_tooltip = {
					liege = { is_within_diplo_range = FROM }
				}	
			}
			prisoner = no
			NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_rejected_slave } }
		}
		effect = {
			liege = {	
				custom_tooltip = { text = TOOLTIPEVTOPTEinteraction.3 }
			}
			hidden_tooltip = { FROM = { character_event = { id = slavery.249 } } }
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}
}
plot_decisions = {
	escape_slavery_decision = {
		potential = {
			has_plot = plot_escape_slavery
			ai = yes # Players should never be slaves in the first place
		}
		allow = { 
			plot_power = 0.5 
			NOT = { has_character_flag = escape_slavery_decision }
			liege = {
				OR = {
					NOT = { has_character_flag = flag_slave_action }
					had_character_flag = { flag = flag_slave_action days = 30 }
				}
			}
		}
		effect = { 
			set_character_flag = escape_slavery_decision
			character_event = { id = slavery.600 days = 1 } 
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.3
			}
			modifier = {
				factor = 0
				OR = {
					NOT = { plot_power = 1 }
					trait = dragon_rider
				}	
				NOT = { trait = wroth }
			}
			modifier = {
				factor = 0
				NOT = { plot_power = 1.5 }
				trait = patient
			}
		}
	}
	buy_freedom_decision = {
		potential = {
			has_plot = plot_escape_slavery
			ai = yes # Players should never be slaves in the first place
		}
		allow = { 
			wealth = 40
			NOT = { has_character_flag = buy_freedom_decision }
			liege = {
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}
		}
		effect = { 
			set_character_flag = buy_freedom_decision			
			liege = {
				set_character_flag = flag_slave_action 
				character_event = { id = slavery.2700 } 
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
}
title_decisions = {
	# If all the realm supports, abolish slavery
	abolish_slavery = {
		is_high_prio = yes
		filter = owned
		ai_target_filter = owned
		only_playable = yes
		
		from_potential = {
			NOT = { has_dlc = "Zeus" } #can control council AI voting
			independent = yes
			higher_tier_than = DUKE
		}
		potential = {
			higher_tier_than = DUKE
			OR = {
				has_law = slavery_1
				has_law = slavery_2
				has_law = slavery_3
			}
		}
		allow = { 	
			FROM = {
				OR = {
					custom_tooltip = {
						text = TOOLTIPslavery_0DYNASTY
						hidden_tooltip = { has_dynasty_flag = liberator_dynasty }
					}							
					trait = liberator			
				}
			}	
			custom_tooltip = {
				text = TOOLTIPabolish_slaveryVASSALS
				hidden_tooltip = {
					NOT = {
						any_de_jure_vassal_title = {
							NOT = { tier = BARON }
							holder_scope = {
								liege = { character = FROM }
								NOT = {
									trait = liberator
								}
							}
						}
					}	
				}
			}
			custom_tooltip = {
				text = TOOLTIPabolish_slaveryPOWERFULVASSAL
				hidden_tooltip = {
					NOT = {
						any_de_jure_vassal_title = {
							NOT = { tier = BARON }
							holder_scope = {
								higher_tier_than = COUNT
								NOT = {
									trait = liberator
								}
							}
						}
					}	
				}
			}
			FROM = {			
				war = no
				prisoner = no
				NOT = { trait = civil_war }
			}	
		} 
		effect = {
			add_law = slavery_0
			hidden_tooltip = {
				save_event_target_as = slavery_title
				any_de_jure_vassal = {
					limit = { ai = no }
					set_character_flag = slavery_law_letter
					letter_event = { id = slavery.752 }
				}
				holder_scope = {
					any_realm_lord = {
						limit = { 
							ai = no 
							NOT = { has_character_flag = slavery_law_letter }
						}
						letter_event = { id = slavery.752 }
					}
				}				
			}
		}
		ai_will_do = {
			factor = 100
			
			modifier = {
				factor = 0
				FROM = {
					trait = just
				}	
			}
		}
	}
	legalise_slavery = {
		is_high_prio = yes
		filter = owned
		ai_target_filter = owned
		only_playable = yes
		
		from_potential = {
			NOT = { has_dlc = "Zeus" } #can control council AI voting
			independent = yes
			higher_tier_than = DUKE
			NAND = { #do not allow legalisation during the conquest
				has_landed_title = e_iron_throne
				has_global_flag = aegons_conquest
			}
		}
		potential = {
			higher_tier_than = DUKE
			has_law = slavery_0
		}
		allow = { 
			FROM = {
				OR = {	

					trait = slave_owner
					trait = slave_trader
				}
				NOT = { trait = liberator }
			}	
			custom_tooltip = {
				text = TOOLTIPlegalise_slaveryVASSALS
				hidden_tooltip = {				
					NOT = {
						any_de_jure_vassal_title = {
							NOT = { tier = BARON }
							holder_scope = {
								liege = { character = FROM }
								OR = {							
									NOT = {
										trait = slave_trader
									}
									trait = liberator
								}
							}
						}
					}	
				}
			}
			custom_tooltip = {
				text = TOOLTIPlegalise_slaveryPOWERFULVASSAL
				hidden_tooltip = {
					NOT = {
						any_de_jure_vassal_title = {
							NOT = { tier = BARON }
							holder_scope = {
								higher_tier_than = COUNT
								OR = {
									trait = liberator
									AND = {
										OR = {
											has_antislavery_culture_trigger = yes
											has_antislavery_religion_trigger = yes
										}	
										NOR = {
											trait = slave_trader
											culture = ironborn
											has_slavery_religion_trigger = yes
											has_slavery_culture_trigger = yes
										}
									}	
								}
							}
						}
					}	
				}
			}
			FROM = {
				war = no
				prisoner = no
				NOT = { trait = civil_war }
			}	
		} 
		effect = {
			if = {
				limit = { FROM = { culture = ironborn } }
				add_law = slavery_3
			}	
			if = {
				limit = { FROM = { NOT = { culture = ironborn } } }
				add_law = slavery_2
			}
			hidden_tooltip = {
				save_event_target_as = slavery_title
				any_de_jure_vassal = {
					limit = { ai = no }
					set_character_flag = slavery_law_letter
					letter_event = { id = slavery.753 }
				}
				holder_scope = {
					any_realm_lord = {
						limit = { 
							ai = no 
							NOT = { has_character_flag = slavery_law_letter }
						}
						letter_event = { id = slavery.753 }
					}
				}				
			}
		}
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				FROM = { has_dynasty_flag = liberator_dynasty }
			}
			modifier = {
				factor = 0
				FROM = {
					NOT = { has_slavery_culture_trigger = yes }
					NOT = { has_slavery_religion_trigger = yes }
					NOT = { culture = ironborn }
				}	
			}
			modifier = {
				factor = 0
				FROM = {
					OR = {
						has_antislavery_culture_trigger = yes
						has_antislavery_religion_trigger = yes
					}
					trait = just
				}	
			}
		}
	}
	
	enslave_natives = {
		is_high_prio = yes
		filter = owned
		ai_target_filter = owned
		only_playable = yes
		
		from_potential = {
			ai = no #AI uses yearly slavery action event
			higher_tier_than = BARON	
			NOT = { culture_group = unoccupied_group }
			has_full_slavery_trigger = yes
			NOR = {
				capital_holding = {
					OR = {
						has_building = ca_asoiaf_slavepit_5
						has_building = ct_asoiaf_slavepit_5
						has_building = tp_asoiaf_slavepit_5
						has_building = no_asoiaf_slavepit_5
					}
				}
				family_palace = { has_building = fp_asoiaf_slavepit_5 }
			}
		}
		potential = {
			tier = COUNT
			holder_scope = { character = FROM }
			location = {
				has_province_flag = colony_province
				OR = {
					has_province_flag = ruined_province
					traditional_nomad_territory_trigger = yes
				}			
			}			
		}
		allow = { 
			location = { 
				NOT = { has_province_modifier = natives_enslaved } 
				NOT = { culture_group = FROM }
			}
			FROM = {
				NOT = { trait = liberator }
				custom_tooltip = {
					text = TOOLTIPSLAVEACTION
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = flag_slave_action }
							had_character_flag = { flag = flag_slave_action days = 30 }
						}
					}
				}
			}	
		} 
		effect = {
			location = {
				add_province_modifier = {
					name = natives_enslaved
					months = 240
				}
			}
			FROM = { 
				character_event = { id = slavery.770 tooltip = "EVTTOOLTIPslavery.770" }
				piety = -50
			}
		}
		ai_will_do = {
			factor = 0		
		}
	}
}